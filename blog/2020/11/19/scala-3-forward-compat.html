<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>Forward Compatibility for the Scala 3 Transition | The Scala Programming Language</title>
    
    <meta property="og:title" content="Forward Compatibility for the Scala 3 Transition"/>
    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@scala_lang"/>
    <meta name="twitter:creator" content="@scala_lang"/>
    
    <meta property="og:url" content="http://localhost:4000/blog/2020/11/19/scala-3-forward-compat.html"/>
    
    <meta property="og:image" content="http://localhost:4000/resources/img/scala-spiral-3d-2-toned-down.png"/>

    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="icon" type="image/png" href="/resources/favicon.ico">
    <link rel="shortcut icon" type="image/png" href="/resources/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/resources/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/resources/favicon-16x16.png">
    <link rel="manifest" href="/resources/site.webmanifest">
    <link rel="mask-icon" href="/resources/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#15a9ce">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
      integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
      crossorigin="anonymous" referrerpolicy="no-referrer">

    <!-- Custom stylesheet -->
    <link href="/resources/css/unslider-dots.css" rel="stylesheet" type="text/css">
    <link href="/resources/css/unslider.css" rel="stylesheet" type="text/css">
    
    <link rel="stylesheet" href="/resources/css/highlightjs.css" type="text/css" />
    
    <link rel="stylesheet" href="/resources/css/style.css" type="text/css" />
    <link rel="stylesheet" href="/resources/css/vendor/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="/resources/css/vendor/monokai.css" type="text/css" />
    <link rel="stylesheet" href="/resources/css/monospace.css" type="text/css" />

    <!-- Typekit (should stay at top of page, do not move to footer)-->
    <!--<script type="text/javascript" src="//use.typekit.net/abh3wgk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script> -->

    <!-- Atom feeds -->
    <link rel="alternate" type="application/atom+xml" title="News Feed" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Feed" href="/feed/blog.xml" />


  </head>
  <body>

<div class="navigation-fade-screen"></div>

<header id="site-header">
	<div class="wrap">
		<nav class="navigation" role="menu">
			<a href="/" class="navigation-bdand">
				<img src="/resources/img/frontpage/scala-logo-white@2x.png" alt="">
			</a>
			<div class="navigation-panel-button">
				<i class="fa fa-bars"></i>
			</div>
			<ul class="navigation-menu">
				
				    <li class="navigation-menu-item">
                    <a href="https://docs.scala-lang.org" >Learn</a>
				    </li>
				
				    <li class="navigation-menu-item">
                    <a href="/download/" >Install</a>
				    </li>
				
				    <li class="navigation-menu-item">
                    <a href="https://scastie.scala-lang.org" >Playground</a>
				    </li>
				
				    <li class="navigation-menu-item">
                    <a href="https://index.scala-lang.org" >Find a Library</a>
				    </li>
				
				    <li class="navigation-menu-item">
                    <a href="/community/" >Community</a>
				    </li>
				
				    <li class="navigation-menu-item">
                    <a href="/blog/" class="active">Blog</a>
				    </li>
				
			</ul>
		</nav>
	</div>
</header>


<main id="inner-main">

	<!-- Title -->
	<section class="title-page">
		<div class="wrap">
			<h1>Forward Compatibility for the Scala 3 Transition</h1>
		</div>
	</section>

	
	<!-- Main content -->
<section class="content">
	<div class="wrap">
		<div class="content-primary">
			<div class="inner-box">
				<div class="blog-detail-head">
					<div>
						<p>Thursday 19 November 2020</p>
						<p>Jamie Thompson, Scala Center</p>
					</div>
					
					<ul class="tag-list">
						
					</ul>
					
					</div>
					<div class="filter-tag"></div>
					<!-- <h2><a href="/blog/2020/11/19/scala-3-forward-compat.html">Forward Compatibility for the Scala 3 Transition</a></h2> -->
					<h1 id="forward-compatibility-for-the-scala-3-transition">Forward Compatibility for the Scala 3 Transition</h1>
<p>Scala 3 is coming, with a release candidate slated for the end of 2020.
With that knowledge comes the inevitable question:
should I migrate, and what is the potential cost?</p>

<p>For maintainers of projects, the migration process may become easier
with the recent release of Scala 2.13.4, which comes with a new preview feature:
reading and compiling against Scala 3 dependencies.</p>

<h2 id="overview">Overview</h2>

<p>With a guided tutorial, we will show you how Scala 2.13.4 makes the following
scenarios easier:</p>
<blockquote>
  <ol>
    <li>You have an application consisting of many subprojects that may depend on
each other, built with Scala 2.13, and would like to transition each one
independently to Scala 3.0</li>
    <li>You have an application, built with Scala 2.13, and want to use some
new features of a library that has migrated to Scala 3.0</li>
  </ol>
</blockquote>

<p>The tutorial will proceed as follows:</p>
<ul>
  <li>We will take a small multi-module project of two sub-projects, a <code class="language-plaintext highlighter-rouge">shared</code> module,
containing simple data structures, and an <code class="language-plaintext highlighter-rouge">app</code> module that depends on <code class="language-plaintext highlighter-rouge">shared</code>.</li>
  <li>We will in turn migrate each sub-project to Scala 3, and show that it does not
matter in which order you migrate the projects, as <code class="language-plaintext highlighter-rouge">app</code> will continue
to build and run.</li>
  <li>To finish, we will add a library dependency on the Scala 3 version of ScalaCheck,
and use it from Scala 2 to validate data structures in the <code class="language-plaintext highlighter-rouge">shared</code> module.</li>
</ul>

<p>A reader applying the steps in the tutorial to their own project should note that not
all features of Scala 3 are forward compatibile with Scala 2, such as <code class="language-plaintext highlighter-rouge">inline</code> methods.
Consequently, we recommend that the user limits their usage of Scala 3 exclusive
features when migrating incrementally. More information is provided in the
<a href="#forward-compatibility">forward compatibility</a> section.</p>

<p>In addition, we provide a <a href="#troubleshooting">troubleshooting</a> section for the reader,
which aims to suggest steps to take when applying this guide to their own projects
and a problem occurs.</p>

<h3 id="status-of-the-tasty-reader">Status of the Tasty Reader</h3>

<blockquote>
  <p>As a quick aside, If you would like to know how it is possible to mix
dependencies between the two compilers, watch the talk
<a href="https://www.youtube.com/watch?v=YQmVrUdx8TU">Taste the Difference with Scala 3</a>.</p>

  <p>To summarise: Scala 3 stores meta information about the code it compiles in
TASTy files, and Scala 2.13 can read these files to learn, for example,
which terms, types and implicits are defined in a given dependency,
and what code needs to be generated to use them correctly. The part of
the compiler that manages this is known as the Tasty Reader.</p>
</blockquote>

<p>Currently, reading Scala 3 dependencies from Scala 2 requires the compiler
flag <code class="language-plaintext highlighter-rouge">-Ytasty-reader</code>. The Tasty Reader feature is currently released as a
preview for users to evaluate and we invite them to
<a href="https://contributors.scala-lang.org/t/roadmap-for-the-tasty-reader-for-scala-2/4231">give feedback</a>
and <a href="https://github.com/scala/bug">report any bugs</a>.
As Scala 3 reaches release, we hope to enable the Tasty Reader by default.</p>

<h2 id="scenarios">Scenarios</h2>

<p>The <a href="#overview">overview</a> section describes two scenarios that we will guide you through
in this blog:</p>
<ul>
  <li>Migrating multi-module projects incrementally from Scala 2 to Scala 3</li>
  <li>Taking advantage of new features in a library that is published for Scala 3.</li>
</ul>

<p>Let’s look at each scenario in turn:</p>

<h3 id="1-migrate-a-multi-module-project-in-any-order">1. Migrate a Multi-Module Project in Any Order</h3>

<p>If you want to migrate a multi module project to Scala 3,
it does not matter in which order you migrate the modules, they will be
able to depend on each other regardless of whether they are compiled with
Scala 2.13 or Scala 3.</p>

<p>To illustrate this scenario, we will start with an empty directory and
build an sbt project with Scala 2.13 that has two modules, <code class="language-plaintext highlighter-rouge">shared</code>,
which has some common domain model data structures, and <code class="language-plaintext highlighter-rouge">app</code>,
which uses those data structures.</p>

<p>For this project, we will pick
<a href="https://github.com/sbt/sbt/releases/tag/v1.4.3">sbt 1.4.3</a>,
this allows you to mix projects of different Scala versions with very
little extra effort (thanks to Eugene Yokota).</p>

<p>To begin, our project looks like the following:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// project/build.properties</span>
<span class="nv">sbt</span><span class="o">.</span><span class="py">version</span><span class="k">=</span><span class="mf">1.4</span><span class="o">.</span><span class="mi">3</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// build.sbt</span>
<span class="nc">ThisBuild</span> <span class="o">/</span> <span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">"2.13.4"</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="nv">shared</span> <span class="k">=</span> <span class="n">project</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="nv">app</span> <span class="k">=</span> <span class="n">project</span>
  <span class="o">.</span><span class="py">dependsOn</span><span class="o">(</span><span class="n">shared</span><span class="o">)</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// shared/src/main/scala/example/Cat.scala</span>
<span class="k">package</span> <span class="nn">example</span>

<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Cat</span> <span class="k">extends</span> <span class="nc">Product</span> <span class="k">with</span> <span class="nc">Serializable</span>
<span class="k">object</span> <span class="nc">Cat</span> <span class="o">{</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">Lion</span>    <span class="k">extends</span> <span class="nc">Cat</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">Tiger</span>   <span class="k">extends</span> <span class="nc">Cat</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">Cheetah</span> <span class="k">extends</span> <span class="nc">Cat</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/src/main/scala/example/Main.scala</span>
<span class="k">package</span> <span class="nn">example</span>

<span class="k">object</span> <span class="nc">Main</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="nf">println</span><span class="o">(</span><span class="nv">Cat</span><span class="o">.</span><span class="py">Tiger</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We can run this application with <code class="language-plaintext highlighter-rouge">sbt app/run</code> which will output the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[info] Compiling 1 Scala source to blog/shared/target/scala-2.13/classes ...
[info] Compiling 1 Scala source to blog/app/target/scala-2.13/classes ...
[info] running example.Main
Tiger
</code></pre></div></div>

<p>At this point we can try something exciting, compile either subproject with
Scala 3 and see if it works.</p>

<p>First, add the dotty plugin (this helps with managing and inspecting the
<code class="language-plaintext highlighter-rouge">scalaVersion</code> setting with Scala 3)</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// project/plugins.sbt</span>
<span class="nf">addSbtPlugin</span><span class="o">(</span><span class="s">"ch.epfl.lamp"</span> <span class="o">%</span> <span class="s">"sbt-dotty"</span> <span class="o">%</span> <span class="s">"0.4.5"</span><span class="o">)</span>
</code></pre></div></div>

<p>Then we can change the <code class="language-plaintext highlighter-rouge">scalaVersion</code> of <code class="language-plaintext highlighter-rouge">app</code>:</p>

<figure class="highlight"><pre><code class="language-diff" data-lang="diff"> // build.sbt
 ThisBuild / scalaVersion := "2.13.4"

 lazy val shared = project

 lazy val app = project
   .dependsOn(shared)
<span class="gi">+  .settings(scalaVersion := "3.0.0-M1")</span></code></pre></figure>

<p>To recap, <code class="language-plaintext highlighter-rouge">app</code> is now compiled by Scala 3 and depends on <code class="language-plaintext highlighter-rouge">shared</code>,
which is compiled by Scala 2.13.</p>

<p>If we do <code class="language-plaintext highlighter-rouge">sbt app/run</code> we should see the <code class="language-plaintext highlighter-rouge">app</code> project recompile
and it will run as before.</p>

<p>Now lets try the other way around, in this case we also have to enable
reading Scala 3 dependencies in Scala 2 with the flag <code class="language-plaintext highlighter-rouge">-Ytasty-reader</code>:</p>

<figure class="highlight"><pre><code class="language-diff" data-lang="diff"> // build.sbt
 ThisBuild / scalaVersion := "2.13.4"

 lazy val shared = project
<span class="gi">+  .settings(scalaVersion := "3.0.0-M1")
</span>
 lazy val app = project
   .dependsOn(shared)
<span class="gd">-  .settings(scalaVersion := "3.0.0-M1")
</span><span class="gi">+  .settings(scalacOptions += "-Ytasty-reader")</span></code></pre></figure>

<p>Here we have the opposite, <code class="language-plaintext highlighter-rouge">app</code> is compiled by Scala 2.13 and depends
on <code class="language-plaintext highlighter-rouge">shared</code>, which is compiled by Scala 3. We can see this more clearly using
the command <code class="language-plaintext highlighter-rouge">sbt 'show app/dependencyTree'</code>, which outputs the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>app:app_2.13:0.1.0-SNAPSHOT [S]
  +-shared:shared_3.0.0-M1:0.1.0-SNAPSHOT
    +-org.scala-lang:scala3-library_3.0.0-M1:3.0.0-M1 [S]
</code></pre></div></div>

<p>If we then try <code class="language-plaintext highlighter-rouge">sbt app/run</code> both <code class="language-plaintext highlighter-rouge">shared</code> and <code class="language-plaintext highlighter-rouge">app</code> subprojects will recompile
and it should work as it always has. If in your own project there are issues
in changing the Scala versions, check out the
<a href="#troubleshooting">troubleshooting</a> section.</p>

<p>To summarise this part, we have shown that it is possible to migrate subprojects
to Scala 3 from Scala 2.13 in any order, gradually, and continue to build and
run them if they mix versions.</p>

<h3 id="2-using-a-scala-3-library-dependency">2. Using a Scala 3 Library Dependency</h3>

<p>In the section above, we have seen how it is possible for a subproject compiled
with Scala 2.13 to depend on a subproject compiled with Scala 3. The same
relationship extends to library dependencies.</p>

<p>To demonstrate using a third party library dependency, we will create a test suite for our
<code class="language-plaintext highlighter-rouge">example.Cat</code> data structure, using ScalaCheck. Here we add it as a library dependency:</p>

<figure class="highlight"><pre><code class="language-diff" data-lang="diff"> // build.sbt
 ThisBuild / scalaVersion := "2.13.4"

 lazy val shared = project
   .settings(scalaVersion := "3.0.0-M1")

 lazy val app = project
   .dependsOn(shared)
   .settings(scalacOptions += "-Ytasty-reader")
<span class="gi">+  .settings(
+    libraryDependencies += "org.scalacheck" % "scalacheck_3.0.0-M1" % "1.15.0"
+  )</span></code></pre></figure>

<p>Notice that in the above snippet, we are using the Scala 3 version of ScalaCheck.
To force a specific Scala version, we take a standard module id and change it as so:</p>

<figure class="highlight"><pre><code class="language-diff" data-lang="diff"><span class="gd">-"org.scalacheck" %% "scalacheck" % "1.15.0"
</span><span class="gi">+"org.scalacheck" % "scalacheck_3.0.0-M1" % "1.15.0"</span></code></pre></figure>

<p>By replacing <code class="language-plaintext highlighter-rouge">%%</code> with <code class="language-plaintext highlighter-rouge">%</code>, we can then manually specify the binary version,
leading us to add <code class="language-plaintext highlighter-rouge">_3.0.0-M1</code> to the name of the module.</p>

<p>As a preliminary, now that <code class="language-plaintext highlighter-rouge">Cat</code> is compiled with Scala 3, we will change the
definition of <code class="language-plaintext highlighter-rouge">Cat</code> to an enumeration, giving us convenient ways to reflect
over its members:</p>

<figure class="highlight"><pre><code class="language-diff" data-lang="diff"> // shared/src/main/scala/example/Cat.scala
 package example

-sealed trait Cat extends Product with Serializable
<span class="gd">-object Cat {
</span><span class="gi">+enum Cat {
</span><span class="gd">-  case object Lion    extends Cat
-  case object Tiger   extends Cat
-  case object Cheetah extends Cat
</span><span class="gi">+  case Lion, Tiger, Cheetah
</span> }</code></pre></figure>

<p>Let’s now make our test suite. As a demonstration we will check two properties:</p>
<ul>
  <li>given two <code class="language-plaintext highlighter-rouge">example.Cat</code> with the same label, they should refer to the same object.</li>
  <li>given two <code class="language-plaintext highlighter-rouge">example.Cat</code> that refer to the same object, they should have the same label.</li>
</ul>

<p>Here is the source code:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/src/test/scala/example/CatSpecification.scala</span>
<span class="k">package</span> <span class="nn">example</span>

<span class="k">import</span> <span class="nn">org.scalacheck.</span><span class="o">{</span><span class="nc">Properties</span><span class="o">,</span> <span class="nc">Gen</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.scalacheck.Prop.forAll</span>

<span class="k">object</span> <span class="nc">CatSpecification</span> <span class="k">extends</span> <span class="nc">Properties</span><span class="o">(</span><span class="s">"Cat"</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">val</span> <span class="nv">allCats</span> <span class="k">=</span> <span class="nv">Cat</span><span class="o">.</span><span class="py">values</span>

  <span class="k">val</span> <span class="nv">genCat</span><span class="k">:</span> <span class="kt">Gen</span><span class="o">[</span><span class="kt">Cat</span><span class="o">]</span> <span class="k">=</span>
    <span class="nf">for</span> <span class="o">(</span><span class="n">x</span> <span class="k">&lt;-</span> <span class="nv">Gen</span><span class="o">.</span><span class="py">choose</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">100</span><span class="o">))</span> <span class="k">yield</span> <span class="nf">allCats</span><span class="o">(</span><span class="n">x</span> <span class="o">%</span> <span class="nv">allCats</span><span class="o">.</span><span class="py">length</span><span class="o">)</span>

  <span class="nf">property</span><span class="o">(</span><span class="s">"`sameName -&gt; identical`"</span><span class="o">)</span> <span class="k">=</span> <span class="nf">forAll</span><span class="o">(</span><span class="n">genCat</span><span class="o">,</span> <span class="n">genCat</span><span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Cat</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Cat</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="nv">a</span><span class="o">.</span><span class="py">productPrefix</span> <span class="o">!=</span> <span class="nv">b</span><span class="o">.</span><span class="py">productPrefix</span> <span class="o">||</span> <span class="nv">a</span><span class="o">.</span><span class="py">eq</span><span class="o">(</span><span class="n">b</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="nf">property</span><span class="o">(</span><span class="s">"`identical -&gt; sameName`"</span><span class="o">)</span> <span class="k">=</span> <span class="nf">forAll</span><span class="o">(</span><span class="n">genCat</span><span class="o">,</span> <span class="n">genCat</span><span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Cat</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Cat</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="nv">a</span><span class="o">.</span><span class="py">ne</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="o">||</span> <span class="nv">a</span><span class="o">.</span><span class="py">productPrefix</span> <span class="o">==</span> <span class="nv">b</span><span class="o">.</span><span class="py">productPrefix</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>If we then use the command <code class="language-plaintext highlighter-rouge">sbt app/test</code> we should see the following output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[info] + Cat.`identical -&gt; sameName`: OK, passed 100 tests.
[info] + Cat.`sameName -&gt; identical`: OK, passed 100 tests.
</code></pre></div></div>

<p>If we then run again <code class="language-plaintext highlighter-rouge">sbt 'show app/dependencyTree'</code> we see the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>app:app_2.13:0.1.0-SNAPSHOT [S]
  +-org.scalacheck:scalacheck_3.0.0-M1:1.15.0
  | +-org.scala-lang:scala3-library_3.0.0-M1:3.0.0-M1 [S]
  | +-org.scala-sbt:test-interface:1.0
  |
  +-shared:shared_3.0.0-M1:0.1.0-SNAPSHOT
    +-org.scala-lang:scala3-library_3.0.0-M1:3.0.0-M1 [S]
</code></pre></div></div>

<p>To summarise, in this section we have shown how it is possible to use a
third party library dependency, compiled with Scala 3, from Scala 2.13.
If there are issues with changing the binary version of a particular
dependency you have, check out the <a href="#troubleshooting">troubleshooting</a> section.</p>

<h2 id="forward-compatibility">Forward Compatibility</h2>
<p>When migrating a subproject to Scala 3, where downstream consuming subprojects are likely to be on Scala 2.13, we would recommend restricting the usage of new features in Scala 3. This will maximise compatibility as you migrate each subproject. However, it is possible to start using some features of Scala 3 without issue, this is due to a limited forward compatibility in Scala 2.13 with some new Scala 3 features.</p>

<p>Forward compatibility means that many definitions created by using new Scala 3 features
can be used from Scala 2.13, however they will be remapped to features
that exist in Scala 2.13. For example,
<a href="https://dotty.epfl.ch/docs/reference/contextual/extension-methods.html">extension methods</a>
can only be used as ordinary methods. So for cross-compatible code we recommend
to continue using implicit classes to encode extension methods.</p>

<p>On the other hand, some features of Scala 3 are not mappable to features in Scala 2.13,
and will cause a compile-time error when using them. A longer list can be seen in the
migration guide, describing <a href="https://docs.scala-lang.org/scala3/guides/migration/compatibility-classpath.html#the-scala-213-tasty-reader">how Scala 2 reacts to different Scala 3 features</a>.</p>

<p>For unsupported features, a best effort is made
to report errors at the use-site that is problematic. For example,
<a href="https://dotty.epfl.ch/docs/reference/new-types/match-types.html">match types</a>
are not supported. If we define in the <code class="language-plaintext highlighter-rouge">shared</code> project the type <code class="language-plaintext highlighter-rouge">Elem</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// shared/src/main/scala/example/MatchTypes.scala</span>
<span class="k">package</span> <span class="nn">example</span>

<span class="k">object</span> <span class="nc">MatchTypes</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Elem</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="n">X</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">List</span><span class="o">[</span><span class="kt">t</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">t</span>
    <span class="k">case</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">t</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">t</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>and then try to use it in the <code class="language-plaintext highlighter-rouge">app</code> project:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/src/main/scala/example/TestMatchTypes.scala</span>
<span class="k">package</span> <span class="nn">example</span>

<span class="k">object</span> <span class="nc">TestMatchTypes</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">test</span><span class="k">:</span> <span class="kt">MatchTypes.Elem</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="s">"hello"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>we get the following error when calling <code class="language-plaintext highlighter-rouge">sbt app/run</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[error] TestMatchTypes.scala:5:25: Unsupported Scala 3 match type in bounds of type Elem; found in object example.MatchTypes.
[error]   def test: MatchTypes.Elem[List[String]] = "hello"
[error]                        ^
[error] one error found
</code></pre></div></div>

<p>The error is standard for all unsupported Scala 3 features, naming the feature,
the location of the definition and the location where it is used.</p>

<h2 id="troubleshooting">Troubleshooting</h2>
<p>There are some situations where the steps described in the sections above do
not work out of the box for your own project, and some other considerations
need to be made.</p>

<p>For the multi module project scenario, let’s say you have two subprojects
<code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code>, where <code class="language-plaintext highlighter-rouge">B</code> depends on <code class="language-plaintext highlighter-rouge">A</code>, both compiled with Scala 2.13.</p>

<h3 id="source-incompatibilities-when-changing-to-scala-3">Source Incompatibilities When Changing to Scala 3</h3>
<p>If you change the <code class="language-plaintext highlighter-rouge">scalaVersion</code> of <code class="language-plaintext highlighter-rouge">A</code> to Scala 3 and <code class="language-plaintext highlighter-rouge">A</code> fails to build,
and the error is not due to a missing dependency, the source code of <code class="language-plaintext highlighter-rouge">A</code> may
be incompatible with Scala 3 and you will have to make some changes.
You can consult the <a href="https://scalacenter.github.io/scala-3-migration-guide/">Scala 3 Migration Guide</a>
to see what changes may be required.</p>

<h3 id="missing-scala-3-dependencies">Missing Scala 3 Dependencies</h3>
<p>If you change the <code class="language-plaintext highlighter-rouge">scalaVersion</code> of <code class="language-plaintext highlighter-rouge">A</code> to Scala 3 and <code class="language-plaintext highlighter-rouge">A</code> fails to build
due to a missing dependency, you can try to use the Scala 2.13 version of
the dependency. The sbt-dotty plugin provides
<a href="https://github.com/lampepfl/dotty-example-project#getting-your-project-to-compile-with-dotty">helper methods</a>
for this.</p>

<h3 id="scala-3-dependencies-that-break-compilation">Scala 3 Dependencies That Break Compilation</h3>

<p>If you successfully migrate subproject <code class="language-plaintext highlighter-rouge">A</code> to Scala 3, but now <code class="language-plaintext highlighter-rouge">B</code> fails
to compile, there are several likely possibilities:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">A</code> has made a deliberate but <a href="#forward-compatibility">forward compatible</a>
change to its API, and <code class="language-plaintext highlighter-rouge">B</code> needs to update to use the new API.</li>
  <li><code class="language-plaintext highlighter-rouge">A</code>, or a transitive dependency of <code class="language-plaintext highlighter-rouge">A</code>, uses a feature of Scala 3 that
is not <a href="#forward-compatibility">forwards compatible</a> with Scala 2.13.</li>
  <li><code class="language-plaintext highlighter-rouge">A</code>, or a transitive dependency of <code class="language-plaintext highlighter-rouge">A</code>, defines a Scala 3
macro but does not provide an equivalent Scala 2 macro (see an
<a href="https://github.com/scalacenter/mix-macros-scala-2-and-3">example project</a>
here for how to provide macros to Scala 2.13 from Scala 3.)</li>
  <li>There is a bug in the implementation of reading Scala 3 dependencies
in Scala 2.13. <a href="https://github.com/scala/bug">Please report here</a>.</li>
</ol>

<h3 id="scala-3-dependencies-that-break-runtime-behaviour">Scala 3 Dependencies that Break Runtime Behaviour</h3>

<p>If you successfully migrate subproject <code class="language-plaintext highlighter-rouge">A</code> to Scala 3, and <code class="language-plaintext highlighter-rouge">B</code> compiles
successfully, but now fails at runtime, there are two likely possibilities:</p>

<ol>
  <li>The definitions in the Scala 3 dependency were correctly read, but
perhaps the API changed subtly, so the code of <code class="language-plaintext highlighter-rouge">B</code> must adapt.
For example, perhaps a default implicit value has been replaced, or other
code has changed its implementation while using the same signature.</li>
  <li>There is a bug in the implementation of reading Scala 3 dependencies
in Scala 2.13. <a href="https://github.com/scala/bug">Please report here</a>.</li>
</ol>

<h3 id="third-party-scala-3-dependencies-that-break-compilationruntime">Third Party Scala 3 Dependencies that Break Compilation/Runtime</h3>
<p>If depending on a third party library, compiled with Scala 3, breaks
compilation, or disrupts runtime behaviour, please consider the above
troubleshooting topics, but instead assume that <code class="language-plaintext highlighter-rouge">A</code> is the third party
library, and <code class="language-plaintext highlighter-rouge">B</code> is your Scala 2.13 project that depends on it.</p>

<h2 id="contributing">Contributing</h2>

<p>If you have found an issue with Scala 3 dependencies in Scala 2.13 and want to try
fixing it in the Scala 2 compiler, you can see a summary of how to work on the
implementation here:
<a href="https://github.com/scala/scala/blob/2.13.x/doc/internal/tastyreader.md#working-with-the-code">Working with the Tasty Reader</a></p>

<h2 id="summary">Summary</h2>

<p>In this blog, we have outlined how it is possible to incrementally migrate a
project to Scala 3 while continuing to use all the parts together during the
transition. We encourage you to try out this process and let us know of any
issues with using Scala 3 dependencies from Scala 2.13.</p>

<h2 id="important-links">Important Links</h2>

<ul>
  <li><a href="https://scalacenter.github.io/scala-3-migration-guide/">Scala 3 Migration Guide</a></li>
  <li><a href="https://github.com/scala/scala/blob/2.13.x/doc/internal/tastyreader.md#working-with-the-code">Doc: Working with the Tasty Reader</a></li>
  <li><a href="https://www.youtube.com/watch?v=YQmVrUdx8TU">Talk: Taste the Difference with Scala 3</a></li>
  <li><a href="https://github.com/scala/bug">Scala 2 issue tracker</a></li>
  <li><a href="https://contributors.scala-lang.org/t/roadmap-for-the-tasty-reader-for-scala-2/4231">Tasty Reader discussion thread</a></li>
</ul>

				</div>
			</div>
			<!-- TOC -->
			
<div class="content-nav">
	<div class="inner-box sidebar-toc-wrapper" style="">
		<h5>Contents</h5>
		<div class="inner-toc" id="sidebar-toc">

		</div>
		<hr>
		<div class="help-us"><a href="https://github.com/scala/scala-lang/blob/master/blog/_posts/2020-11-19-scala-3-forward-compat.md" data-proofer-ignore><i class="fa fa-pencil" aria-hidden="true"></i> Problem with this page?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please help us fix it!</a></div>
	</div>
</div>


		</div>
	</div>
</section>


</main>

<footer id="site-footer">
    <div class="wrap">
      <div class="site-footer-top">
        
          <ul class="documentation">
            <li><h3>Documentation</h3></li>
            
              
                <li><a href="https://docs.scala-lang.org/getting-started.html">Getting Started</a></li>
              
            
              
                <li><a href="https://www.scala-lang.org/api/current/index.html">API</a></li>
              
            
              
                <li><a href="https://docs.scala-lang.org/overviews">Overviews/Guides</a></li>
              
            
              
                <li><a href="https://scala-lang.org/files/archive/spec/2.13/">Language Specification</a></li>
              
            
          </ul>
        
          <ul class="download">
            <li><h3>Download</h3></li>
            
              
                <li><a href="/download/">Current Version</a></li>
              
            
              
                <li><a href="/download/all.html">All versions</a></li>
              
            
          </ul>
        
          <ul class="community">
            <li><h3>Community</h3></li>
            
              
                <li><a href="/community/">Community</a></li>
              
            
              
                <li><a href="/community/index.html#forums">Forums</a></li>
              
            
              
                <li><a href="/community/index.html#chat-rooms">Chat</a></li>
              
            
              
                <li><a href="/community/index.html#community-libraries-and-tools">Libraries and Tools</a></li>
              
            
              
                <li><a href="https://scala.epfl.ch/">The Scala Center</a></li>
              
            
          </ul>
        
          <ul class="contribute">
            <li><h3>Contribute</h3></li>
            
              
                <li><a href="/contribute/">How to help</a></li>
              
            
              
                <li><a href="/contribute/bug-reporting-guide.html">Report an Issue</a></li>
              
            
          </ul>
        
          <ul class="scala">
            <li><h3>Scala</h3></li>
            
              
                <li><a href="/blog/">Blog</a></li>
              
            
              
                <li><a href="/conduct.html">Code of Conduct</a></li>
              
            
              
                <li><a href="/license/">License</a></li>
              
            
          </ul>
        
          <ul class="social">
            <li><h3>Social</h3></li>
            
              
                <li><a href="https://github.com/scala">GitHub</a></li>
              
            
              
                 <!-- special case Manstodon to validate with rel="me" -->
                <li><a rel="me" href="https://fosstodon.org/@scala_lang">Mastodon</a></li>
              
            
              
                <li><a href="https://twitter.com/scala_lang">Twitter</a></li>
              
            
              
                <li><a href="https://discord.com/invite/scala">Discord</a></li>
              
            
              
                <li><a href="https://www.linkedin.com/company/scala-center/">LinkedIn</a></li>
              
            
          </ul>
        
      </div>
      <div class="site-footer-bottom">
        <p>Copyright © 2002-2023 École Polytechnique Fédérale <br>Lausanne (EPFL) Lausanne, Switzerland</p>
        <img src="/resources/img/frontpage/scala-logo-white.png" alt="">
      </div>
    </div>
  </footer>

    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="/resources/js/vendor/jquery.autocomplete.js" type="text/javascript" ></script>

    <!-- tweet feed -->
    <script src="/resources/js/tweetMachine-update.js" type="text/javascript" ></script>

    <!-- prettify js -->
    <script src="/resources/js/vendor/prettify/prettify.js" type="text/javascript" ></script>
    <script src="/resources/js/vendor/prettify/lang-scala.js" type="text/javascript" ></script>

    <!-- unslider js -->
    <script src="/resources/js/vendor/unslider.js" type="text/javascript" ></script>

    <!-- Highlight -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/scala.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/java.min.js" type="text/javascript"></script>

    <!-- Custom Syntax Highlight -->
    <script src="/resources/js/hljs-scala3.js" type="text/javascript"></script>

    <!-- CodeMirror -->
    <script src="/resources/js/vendor/codemirror/codemirror.js" type="text/javascript"></script>
    <script src="/resources/js/vendor/codemirror/clike.js" type="text/javascript"></script>

    <!-- TOC -->
    
      <script src="/resources/js/vendor/jquery.sticky.js" type="text/javascript" ></script>
      <script src="/resources/js/vendor/toc.js" type="text/javascript" ></script>
    

    <!-- Blog search -->
    <script src="/resources/js/vendor/jekyll.search.min.js" type="text/javascript"></script>

    <!-- Custom javascript -->
    <script src="/resources/js/functions.js" type="text/javascript"></script>
    <script defer data-domain="scala-lang.org" src="https://plausible.scala-lang.org/js/script.js"></script>
  </body>
</html>
